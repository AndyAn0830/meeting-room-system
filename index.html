
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會議室借用系統</title>
    <meta name="description" content="會議室借用管理系統 - 支援QR Code掃描借用">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function MeetingRoomSystem() {
          // 會議室資料
          const [rooms] = useState([
            { id: 1, name: '第一會議室' },
            { id: 2, name: '二期講堂' },
            { id: 3, name: '合心會議室' },
            { id: 4, name: '和氣會議室' },
            { id: 5, name: '互愛會議室' },
            { id: 6, name: '貴賓室' },
            { id: 7, name: '協力講堂' }
          ]);

          // 借用記錄 - 使用 localStorage 儲存
          const [bookings, setBookings] = useState(() => {
            const saved = localStorage.getItem('meetingRoomBookings');
            return saved ? JSON.parse(saved) : [];
          });
          
          // 表單資料 - 從 URL 參數自動填入會議室
          const [formData, setFormData] = useState(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const roomParam = urlParams.get('room');
            
            return {
              roomId: roomParam || '',
              borrower: '',
              extension: '',
              date: '',
              startTime: ''
            };
          });

          // 系統模式：user(使用者) 或 admin(管理員)
          const [systemMode, setSystemMode] = useState('user');
          
          // 管理員登入狀態
          const [showLoginModal, setShowLoginModal] = useState(false);
          const [loginData, setLoginData] = useState({
            username: '',
            password: ''
          });
          
          // 管理員頁面
          const [adminView, setAdminView] = useState('records');
          const [recordView, setRecordView] = useState('current');
          const [selectedBookings, setSelectedBookings] = useState([]);

          // 儲存到 localStorage
          React.useEffect(() => {
            localStorage.setItem('meetingRoomBookings', JSON.stringify(bookings));
          }, [bookings]);

          // 處理登入表單輸入
          const handleLoginInputChange = (e) => {
            const { name, value } = e.target;
            setLoginData(prev => ({
              ...prev,
              [name]: value
            }));
          };

          // 管理員登入驗證
          const handleAdminLogin = () => {
            if (loginData.username === 'hl1234' && loginData.password === 'admin1234') {
              setSystemMode('admin');
              setShowLoginModal(false);
              setLoginData({ username: '', password: '' });
              alert('登入成功！歡迎使用管理系統');
            } else {
              alert('帳號或密碼錯誤！請重新輸入');
              setLoginData({ username: '', password: '' });
            }
          };

          // 處理表單輸入
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({
              ...prev,
              [name]: value
            }));
          };

          // 使用者借用提交
          const handleUserBookingSubmit = () => {
            if (!formData.roomId || !formData.borrower || !formData.extension || !formData.date || !formData.startTime) {
              alert('請填寫所有必填欄位！');
              return;
            }

            const selectedRoom = rooms.find(room => room.id === parseInt(formData.roomId));
            
            const hasConflict = bookings.some(booking => 
              booking.roomId === parseInt(formData.roomId) &&
              booking.date === formData.date &&
              booking.startTime === formData.startTime &&
              booking.status === '借用中'
            );

            if (hasConflict) {
              alert('該會議室在此時間已被預約！請選擇其他時間。');
              return;
            }

            const newBooking = {
              id: Date.now(),
              roomId: parseInt(formData.roomId),
              roomName: selectedRoom.name,
              borrower: formData.borrower,
              extension: formData.extension,
              date: formData.date,
              startTime: formData.startTime,
              status: '借用中',
              bookingTime: new Date().toLocaleString()
            };

            setBookings([...bookings, newBooking]);
            
            setFormData({
              roomId: '',
              borrower: '',
              extension: '',
              date: '',
              startTime: ''
            });

            alert('🎉 借用成功！\n\n會議室已為您保留，請到櫃台索取鑰匙。');
          };

          // 管理員功能
          const handleCheckboxChange = (bookingId) => {
            if (selectedBookings.includes(bookingId)) {
              setSelectedBookings(selectedBookings.filter(id => id !== bookingId));
            } else {
              setSelectedBookings([...selectedBookings, bookingId]);
            }
          };

          const returnSelectedBookings = () => {
            if (selectedBookings.length === 0) {
              alert('請先選擇要歸還的記錄！');
              return;
            }
            
            const currentTime = new Date().toLocaleString();
            const newBookings = bookings.map(booking => {
              if (selectedBookings.includes(booking.id) && booking.status === '借用中') {
                return {
                  ...booking,
                  status: '已歸還',
                  returnTime: currentTime
                };
              }
              return booking;
            });
            
            setBookings(newBookings);
            setSelectedBookings([]);
            alert(`已歸還 ${selectedBookings.length} 筆記錄！`);
          };

          // 使用者介面（前台）
          if (systemMode === 'user') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                {/* 手機版標題 */}
                <div className="bg-white shadow-md p-4 mb-4 relative">
                  <div className="text-center">
                    <div className="text-4xl mb-2">🏢</div>
                    <h1 className="text-xl font-bold text-gray-800">會議室借用系統</h1>
                    <p className="text-sm text-gray-600">請填寫借用資訊</p>
                  </div>
                  
                  <button
                    onClick={() => setShowLoginModal(true)}
                    className="absolute top-4 right-4 bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600"
                  >
                    🔧 管理員
                  </button>
                </div>

                <div className="px-4 pb-4">
                  {/* QR Code 提示卡片 */}
                  {formData.roomId && (
                    <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r-lg">
                      <div className="flex items-center">
                        <div className="text-xl mr-3">📱</div>
                        <div>
                          <p className="font-medium text-blue-800">
                            您正在借用：{rooms.find(r => r.id === parseInt(formData.roomId))?.name}
                          </p>
                          <p className="text-sm text-blue-700">請繼續填寫其他資訊</p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 借用表單 */}
                  <div className="bg-white rounded-lg shadow-md">
                    <div className="p-4 border-b border-gray-200">
                      <h2 className="text-lg font-bold text-gray-800">📝 借用申請</h2>
                    </div>
                    
                    <div className="p-4 space-y-4">
                      {/* 會議室選擇 */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          🏠 選擇會議室 <span className="text-red-500">*</span>
                        </label>
                        <select
                          name="roomId"
                          value={formData.roomId}
                          onChange={handleInputChange}
                          className={`w-full p-3 border-2 rounded-lg text-base focus:outline-none transition-colors ${
                            formData.roomId 
                              ? 'border-blue-500 bg-blue-50' 
                              : 'border-gray-300 focus:border-blue-500'
                          }`}
                        >
                          <option value="">請選擇會議室</option>
                          {rooms.map(room => (
                            <option key={room.id} value={room.id}>
                              {room.name}
                            </option>
                          ))}
                        </select>
                      </div>

                      {/* 借用人 */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          👤 借用人 <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          name="borrower"
                          value={formData.borrower}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                          placeholder="請輸入您的姓名"
                        />
                      </div>

                      {/* 分機號碼 */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          📞 分機號碼 <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="tel"
                          name="extension"
                          value={formData.extension}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                          placeholder="請輸入分機號碼"
                        />
                      </div>

                      {/* 借用日期 */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          📅 借用日期 <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="date"
                          name="date"
                          value={formData.date}
                          onChange={handleInputChange}
                          min={new Date().toISOString().split('T')[0]}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                        />
                      </div>

                      {/* 借用時間 */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ⏰ 借用時間 <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="time"
                          name="startTime"
                          value={formData.startTime}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                        />
                      </div>
                    </div>

                    {/* 提交按鈕 */}
                    <div className="p-4 bg-gray-50 rounded-b-lg">
                      <button
                        onClick={handleUserBookingSubmit}
                        className="w-full bg-green-500 text-white py-4 rounded-lg text-lg font-bold hover:bg-green-600 transition-colors shadow-lg"
                      >
                        ✅ 確認借用
                      </button>
                    </div>
                  </div>

                  {/* 使用提醒 */}
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
                    <div className="flex items-start space-x-3">
                      <div className="text-xl">💡</div>
                      <div>
                        <h3 className="font-medium text-yellow-800 mb-2">使用提醒</h3>
                        <ul className="text-sm text-yellow-700 space-y-1">
                          <li>• 填寫完成後請到櫃台索取鑰匙</li>
                          <li>• 請準時使用會議室</li>
                          <li>• 使用完畢請歸還鑰匙</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 管理員登入彈窗 */}
                {showLoginModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-2xl w-full max-w-sm">
                      <div className="p-6">
                        <h3 className="text-xl font-bold text-center text-gray-800 mb-6">
                          🔐 管理員登入
                        </h3>
                        
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              👤 帳號
                            </label>
                            <input
                              type="text"
                              name="username"
                              value={loginData.username}
                              onChange={handleLoginInputChange}
                              className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                              placeholder="請輸入管理員帳號"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              🔒 密碼
                            </label>
                            <input
                              type="password"
                              name="password"
                              value={loginData.password}
                              onChange={handleLoginInputChange}
                              className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                              placeholder="請輸入密碼"
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                  handleAdminLogin();
                                }
                              }}
                            />
                          </div>
                        </div>
                        
                        <div className="flex space-x-3 mt-6">
                          <button
                            onClick={() => {
                              setShowLoginModal(false);
                              setLoginData({ username: '', password: '' });
                            }}
                            className="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors"
                          >
                            取消
                          </button>
                          <button
                            onClick={handleAdminLogin}
                            className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors"
                          >
                            登入
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          // 管理員介面（後台）
          return (
            <div className="min-h-screen bg-gray-50 p-4">
              <div className="max-w-7xl mx-auto">
                {/* 管理員標題 */}
                <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                  <div className="flex justify-between items-center">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-800">
                        🛠️ 會議室管理後台
                      </h1>
                      <p className="text-gray-600 mt-1">管理員專用 - 記錄查看與歸還功能</p>
                    </div>
                    <button
                      onClick={() => setSystemMode('user')}
                      className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
                    >
                      👤 切換到使用者介面
                    </button>
                  </div>
                </div>

                {/* 記錄管理頁面 */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h2 className="text-2xl font-bold mb-6 text-gray-800">📋 借用記錄管理</h2>
                  
                  {/* 記錄類型切換 */}
                  <div className="flex space-x-4 mb-6">
                    <button
                      onClick={() => setRecordView('current')}
                      className={`px-4 py-2 rounded-lg font-medium ${
                        recordView === 'current'
                          ? 'bg-green-500 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      🟢 目前借用中 ({bookings.filter(b => b.status === '借用中').length})
                    </button>
                    <button
                      onClick={() => setRecordView('all')}
                      className={`px-4 py-2 rounded-lg font-medium ${
                        recordView === 'all'
                          ? 'bg-blue-500 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      📋 全部記錄 ({bookings.length})
                    </button>
                  </div>

                  {(() => {
                    let filteredBookings = bookings;
                    if (recordView === 'current') {
                      filteredBookings = bookings.filter(b => b.status === '借用中');
                    }

                    return filteredBookings.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">📭</div>
                        <p className="text-xl text-gray-500">
                          {recordView === 'current' ? '目前沒有借用中的記錄' : '目前沒有任何記錄'}
                        </p>
                      </div>
                    ) : (
                      <div>
                        {/* 管理操作按鈕 */}
                        {recordView === 'current' && (
                          <div className="mb-6 flex space-x-4 bg-gray-50 p-4 rounded-lg">
                            <button
                              onClick={returnSelectedBookings}
                              className="bg-orange-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-orange-600 transition-colors"
                            >
                              🔄 歸還選中的記錄
                            </button>
                            <div className="text-gray-600 flex items-center bg-white px-4 py-3 rounded-lg">
                              已選擇: <span className="font-bold text-blue-600 ml-1">{selectedBookings.length}</span> 筆
                            </div>
                          </div>
                        )}

                        {/* 記錄列表 */}
                        <div className="space-y-4">
                          {filteredBookings.map(booking => (
                            <div 
                              key={booking.id} 
                              className={`border-2 rounded-lg p-6 transition-all ${
                                selectedBookings.includes(booking.id)
                                  ? 'border-blue-500 bg-blue-50'
                                  : 'border-gray-200 hover:shadow-md'
                              }`}
                            >
                              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-center">
                                {/* 複選框 + 會議室 */}
                                <div className="flex items-center space-x-3">
                                  {recordView === 'current' && booking.status === '借用中' && (
                                    <input
                                      type="checkbox"
                                      checked={selectedBookings.includes(booking.id)}
                                      onChange={() => handleCheckboxChange(booking.id)}
                                      className="w-5 h-5 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500"
                                    />
                                  )}
                                  <div>
                                    <div className="text-lg font-bold text-blue-600">
                                      🏠 {booking.roomName}
                                    </div>
                                  </div>
                                </div>

                                {/* 借用人資訊 */}
                                <div>
                                  <div className="font-medium text-gray-800">
                                    👤 {booking.borrower}
                                  </div>
                                  <div className="text-gray-600 text-sm">
                                    📞 分機: {booking.extension}
                                  </div>
                                </div>

                                {/* 時間資訊 */}
                                <div>
                                  <div className="text-gray-600 text-sm">
                                    📅 {booking.date}
                                  </div>
                                  <div className="text-gray-600 text-sm">
                                    ⏰ {booking.startTime}
                                  </div>
                                </div>

                                {/* 狀態 */}
                                <div>
                                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                    booking.status === '借用中'
                                      ? 'bg-green-100 text-green-800'
                                      : 'bg-gray-100 text-gray-800'
                                  }`}>
                                    {booking.status === '借用中' ? '✅' : '🔄'} {booking.status}
                                  </span>
                                  {booking.returnTime && (
                                    <div className="text-xs text-gray-500 mt-1">
                                      🔄 {booking.returnTime}
                                    </div>
                                  )}
                                </div>

                                {/* ID */}
                                <div className="text-sm text-gray-500">
                                  ID: {booking.id}
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<MeetingRoomSystem />, document.getElementById('root'));
    </script>
</body>
</html>
