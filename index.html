
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒè­°å®¤å€Ÿç”¨ç³»çµ±</title>
    <meta name="description" content="æœƒè­°å®¤å€Ÿç”¨ç®¡ç†ç³»çµ± - æ”¯æ´QR Codeæƒæå€Ÿç”¨">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function MeetingRoomSystem() {
          // æœƒè­°å®¤è³‡æ–™
          const [rooms] = useState([
            { id: 1, name: 'ç¬¬ä¸€æœƒè­°å®¤' },
            { id: 2, name: 'äºŒæœŸè¬›å ‚' },
            { id: 3, name: 'åˆå¿ƒæœƒè­°å®¤' },
            { id: 4, name: 'å’Œæ°£æœƒè­°å®¤' },
            { id: 5, name: 'äº’æ„›æœƒè­°å®¤' },
            { id: 6, name: 'è²´è³“å®¤' },
            { id: 7, name: 'å”åŠ›è¬›å ‚' }
          ]);

          // å€Ÿç”¨è¨˜éŒ„ - ä½¿ç”¨ localStorage å„²å­˜
          const [bookings, setBookings] = useState(() => {
            const saved = localStorage.getItem('meetingRoomBookings');
            return saved ? JSON.parse(saved) : [];
          });
          
          // è¡¨å–®è³‡æ–™ - å¾ URL åƒæ•¸è‡ªå‹•å¡«å…¥æœƒè­°å®¤
          const [formData, setFormData] = useState(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const roomParam = urlParams.get('room');
            
            return {
              roomId: roomParam || '',
              borrower: '',
              extension: '',
              date: '',
              startTime: ''
            };
          });

          // ç³»çµ±æ¨¡å¼ï¼šuser(ä½¿ç”¨è€…) æˆ– admin(ç®¡ç†å“¡)
          const [systemMode, setSystemMode] = useState('user');
          
          // ç®¡ç†å“¡ç™»å…¥ç‹€æ…‹
          const [showLoginModal, setShowLoginModal] = useState(false);
          const [loginData, setLoginData] = useState({
            username: '',
            password: ''
          });
          
          // ç®¡ç†å“¡é é¢
          const [adminView, setAdminView] = useState('records');
          const [recordView, setRecordView] = useState('current');
          const [selectedBookings, setSelectedBookings] = useState([]);

          // å„²å­˜åˆ° localStorage
          React.useEffect(() => {
            localStorage.setItem('meetingRoomBookings', JSON.stringify(bookings));
          }, [bookings]);

          // è™•ç†ç™»å…¥è¡¨å–®è¼¸å…¥
          const handleLoginInputChange = (e) => {
            const { name, value } = e.target;
            setLoginData(prev => ({
              ...prev,
              [name]: value
            }));
          };

          // ç®¡ç†å“¡ç™»å…¥é©—è­‰
          const handleAdminLogin = () => {
            if (loginData.username === 'hl1234' && loginData.password === 'admin1234') {
              setSystemMode('admin');
              setShowLoginModal(false);
              setLoginData({ username: '', password: '' });
              alert('ç™»å…¥æˆåŠŸï¼æ­¡è¿ä½¿ç”¨ç®¡ç†ç³»çµ±');
            } else {
              alert('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼è«‹é‡æ–°è¼¸å…¥');
              setLoginData({ username: '', password: '' });
            }
          };

          // è™•ç†è¡¨å–®è¼¸å…¥
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({
              ...prev,
              [name]: value
            }));
          };

          // ä½¿ç”¨è€…å€Ÿç”¨æäº¤
          const handleUserBookingSubmit = () => {
            if (!formData.roomId || !formData.borrower || !formData.extension || !formData.date || !formData.startTime) {
              alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
              return;
            }

            const selectedRoom = rooms.find(room => room.id === parseInt(formData.roomId));
            
            const hasConflict = bookings.some(booking => 
              booking.roomId === parseInt(formData.roomId) &&
              booking.date === formData.date &&
              booking.startTime === formData.startTime &&
              booking.status === 'å€Ÿç”¨ä¸­'
            );

            if (hasConflict) {
              alert('è©²æœƒè­°å®¤åœ¨æ­¤æ™‚é–“å·²è¢«é ç´„ï¼è«‹é¸æ“‡å…¶ä»–æ™‚é–“ã€‚');
              return;
            }

            const newBooking = {
              id: Date.now(),
              roomId: parseInt(formData.roomId),
              roomName: selectedRoom.name,
              borrower: formData.borrower,
              extension: formData.extension,
              date: formData.date,
              startTime: formData.startTime,
              status: 'å€Ÿç”¨ä¸­',
              bookingTime: new Date().toLocaleString()
            };

            setBookings([...bookings, newBooking]);
            
            setFormData({
              roomId: '',
              borrower: '',
              extension: '',
              date: '',
              startTime: ''
            });

            alert('ğŸ‰ å€Ÿç”¨æˆåŠŸï¼\n\næœƒè­°å®¤å·²ç‚ºæ‚¨ä¿ç•™ï¼Œè«‹åˆ°æ«ƒå°ç´¢å–é‘°åŒ™ã€‚');
          };

          // ç®¡ç†å“¡åŠŸèƒ½
          const handleCheckboxChange = (bookingId) => {
            if (selectedBookings.includes(bookingId)) {
              setSelectedBookings(selectedBookings.filter(id => id !== bookingId));
            } else {
              setSelectedBookings([...selectedBookings, bookingId]);
            }
          };

          const returnSelectedBookings = () => {
            if (selectedBookings.length === 0) {
              alert('è«‹å…ˆé¸æ“‡è¦æ­¸é‚„çš„è¨˜éŒ„ï¼');
              return;
            }
            
            const currentTime = new Date().toLocaleString();
            const newBookings = bookings.map(booking => {
              if (selectedBookings.includes(booking.id) && booking.status === 'å€Ÿç”¨ä¸­') {
                return {
                  ...booking,
                  status: 'å·²æ­¸é‚„',
                  returnTime: currentTime
                };
              }
              return booking;
            });
            
            setBookings(newBookings);
            setSelectedBookings([]);
            alert(`å·²æ­¸é‚„ ${selectedBookings.length} ç­†è¨˜éŒ„ï¼`);
          };

          // ä½¿ç”¨è€…ä»‹é¢ï¼ˆå‰å°ï¼‰
          if (systemMode === 'user') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                {/* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œ */}
                <div className="bg-white shadow-md p-4 mb-4 relative">
                  <div className="text-center">
                    <div className="text-4xl mb-2">ğŸ¢</div>
                    <h1 className="text-xl font-bold text-gray-800">æœƒè­°å®¤å€Ÿç”¨ç³»çµ±</h1>
                    <p className="text-sm text-gray-600">è«‹å¡«å¯«å€Ÿç”¨è³‡è¨Š</p>
                  </div>
                  
                  <button
                    onClick={() => setShowLoginModal(true)}
                    className="absolute top-4 right-4 bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600"
                  >
                    ğŸ”§ ç®¡ç†å“¡
                  </button>
                </div>

                <div className="px-4 pb-4">
                  {/* QR Code æç¤ºå¡ç‰‡ */}
                  {formData.roomId && (
                    <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r-lg">
                      <div className="flex items-center">
                        <div className="text-xl mr-3">ğŸ“±</div>
                        <div>
                          <p className="font-medium text-blue-800">
                            æ‚¨æ­£åœ¨å€Ÿç”¨ï¼š{rooms.find(r => r.id === parseInt(formData.roomId))?.name}
                          </p>
                          <p className="text-sm text-blue-700">è«‹ç¹¼çºŒå¡«å¯«å…¶ä»–è³‡è¨Š</p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* å€Ÿç”¨è¡¨å–® */}
                  <div className="bg-white rounded-lg shadow-md">
                    <div className="p-4 border-b border-gray-200">
                      <h2 className="text-lg font-bold text-gray-800">ğŸ“ å€Ÿç”¨ç”³è«‹</h2>
                    </div>
                    
                    <div className="p-4 space-y-4">
                      {/* æœƒè­°å®¤é¸æ“‡ */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ğŸ  é¸æ“‡æœƒè­°å®¤ <span className="text-red-500">*</span>
                        </label>
                        <select
                          name="roomId"
                          value={formData.roomId}
                          onChange={handleInputChange}
                          className={`w-full p-3 border-2 rounded-lg text-base focus:outline-none transition-colors ${
                            formData.roomId 
                              ? 'border-blue-500 bg-blue-50' 
                              : 'border-gray-300 focus:border-blue-500'
                          }`}
                        >
                          <option value="">è«‹é¸æ“‡æœƒè­°å®¤</option>
                          {rooms.map(room => (
                            <option key={room.id} value={room.id}>
                              {room.name}
                            </option>
                          ))}
                        </select>
                      </div>

                      {/* å€Ÿç”¨äºº */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ğŸ‘¤ å€Ÿç”¨äºº <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          name="borrower"
                          value={formData.borrower}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                          placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å"
                        />
                      </div>

                      {/* åˆ†æ©Ÿè™Ÿç¢¼ */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ğŸ“ åˆ†æ©Ÿè™Ÿç¢¼ <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="tel"
                          name="extension"
                          value={formData.extension}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                          placeholder="è«‹è¼¸å…¥åˆ†æ©Ÿè™Ÿç¢¼"
                        />
                      </div>

                      {/* å€Ÿç”¨æ—¥æœŸ */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ğŸ“… å€Ÿç”¨æ—¥æœŸ <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="date"
                          name="date"
                          value={formData.date}
                          onChange={handleInputChange}
                          min={new Date().toISOString().split('T')[0]}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                        />
                      </div>

                      {/* å€Ÿç”¨æ™‚é–“ */}
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          â° å€Ÿç”¨æ™‚é–“ <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="time"
                          name="startTime"
                          value={formData.startTime}
                          onChange={handleInputChange}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-base focus:border-blue-500 focus:outline-none"
                        />
                      </div>
                    </div>

                    {/* æäº¤æŒ‰éˆ• */}
                    <div className="p-4 bg-gray-50 rounded-b-lg">
                      <button
                        onClick={handleUserBookingSubmit}
                        className="w-full bg-green-500 text-white py-4 rounded-lg text-lg font-bold hover:bg-green-600 transition-colors shadow-lg"
                      >
                        âœ… ç¢ºèªå€Ÿç”¨
                      </button>
                    </div>
                  </div>

                  {/* ä½¿ç”¨æé†’ */}
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
                    <div className="flex items-start space-x-3">
                      <div className="text-xl">ğŸ’¡</div>
                      <div>
                        <h3 className="font-medium text-yellow-800 mb-2">ä½¿ç”¨æé†’</h3>
                        <ul className="text-sm text-yellow-700 space-y-1">
                          <li>â€¢ å¡«å¯«å®Œæˆå¾Œè«‹åˆ°æ«ƒå°ç´¢å–é‘°åŒ™</li>
                          <li>â€¢ è«‹æº–æ™‚ä½¿ç”¨æœƒè­°å®¤</li>
                          <li>â€¢ ä½¿ç”¨å®Œç•¢è«‹æ­¸é‚„é‘°åŒ™</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                {/* ç®¡ç†å“¡ç™»å…¥å½ˆçª— */}
                {showLoginModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-2xl w-full max-w-sm">
                      <div className="p-6">
                        <h3 className="text-xl font-bold text-center text-gray-800 mb-6">
                          ğŸ” ç®¡ç†å“¡ç™»å…¥
                        </h3>
                        
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              ğŸ‘¤ å¸³è™Ÿ
                            </label>
                            <input
                              type="text"
                              name="username"
                              value={loginData.username}
                              onChange={handleLoginInputChange}
                              className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                              placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¸³è™Ÿ"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              ğŸ”’ å¯†ç¢¼
                            </label>
                            <input
                              type="password"
                              name="password"
                              value={loginData.password}
                              onChange={handleLoginInputChange}
                              className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                              placeholder="è«‹è¼¸å…¥å¯†ç¢¼"
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                  handleAdminLogin();
                                }
                              }}
                            />
                          </div>
                        </div>
                        
                        <div className="flex space-x-3 mt-6">
                          <button
                            onClick={() => {
                              setShowLoginModal(false);
                              setLoginData({ username: '', password: '' });
                            }}
                            className="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors"
                          >
                            å–æ¶ˆ
                          </button>
                          <button
                            onClick={handleAdminLogin}
                            className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors"
                          >
                            ç™»å…¥
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          // ç®¡ç†å“¡ä»‹é¢ï¼ˆå¾Œå°ï¼‰
          return (
            <div className="min-h-screen bg-gray-50 p-4">
              <div className="max-w-7xl mx-auto">
                {/* ç®¡ç†å“¡æ¨™é¡Œ */}
                <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                  <div className="flex justify-between items-center">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-800">
                        ğŸ› ï¸ æœƒè­°å®¤ç®¡ç†å¾Œå°
                      </h1>
                      <p className="text-gray-600 mt-1">ç®¡ç†å“¡å°ˆç”¨ - è¨˜éŒ„æŸ¥çœ‹èˆ‡æ­¸é‚„åŠŸèƒ½</p>
                    </div>
                    <button
                      onClick={() => setSystemMode('user')}
                      className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
                    >
                      ğŸ‘¤ åˆ‡æ›åˆ°ä½¿ç”¨è€…ä»‹é¢
                    </button>
                  </div>
                </div>

                {/* è¨˜éŒ„ç®¡ç†é é¢ */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h2 className="text-2xl font-bold mb-6 text-gray-800">ğŸ“‹ å€Ÿç”¨è¨˜éŒ„ç®¡ç†</h2>
                  
                  {/* è¨˜éŒ„é¡å‹åˆ‡æ› */}
                  <div className="flex space-x-4 mb-6">
                    <button
                      onClick={() => setRecordView('current')}
                      className={`px-4 py-2 rounded-lg font-medium ${
                        recordView === 'current'
                          ? 'bg-green-500 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      ğŸŸ¢ ç›®å‰å€Ÿç”¨ä¸­ ({bookings.filter(b => b.status === 'å€Ÿç”¨ä¸­').length})
                    </button>
                    <button
                      onClick={() => setRecordView('all')}
                      className={`px-4 py-2 rounded-lg font-medium ${
                        recordView === 'all'
                          ? 'bg-blue-500 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      ğŸ“‹ å…¨éƒ¨è¨˜éŒ„ ({bookings.length})
                    </button>
                  </div>

                  {(() => {
                    let filteredBookings = bookings;
                    if (recordView === 'current') {
                      filteredBookings = bookings.filter(b => b.status === 'å€Ÿç”¨ä¸­');
                    }

                    return filteredBookings.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">ğŸ“­</div>
                        <p className="text-xl text-gray-500">
                          {recordView === 'current' ? 'ç›®å‰æ²’æœ‰å€Ÿç”¨ä¸­çš„è¨˜éŒ„' : 'ç›®å‰æ²’æœ‰ä»»ä½•è¨˜éŒ„'}
                        </p>
                      </div>
                    ) : (
                      <div>
                        {/* ç®¡ç†æ“ä½œæŒ‰éˆ• */}
                        {recordView === 'current' && (
                          <div className="mb-6 flex space-x-4 bg-gray-50 p-4 rounded-lg">
                            <button
                              onClick={returnSelectedBookings}
                              className="bg-orange-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-orange-600 transition-colors"
                            >
                              ğŸ”„ æ­¸é‚„é¸ä¸­çš„è¨˜éŒ„
                            </button>
                            <div className="text-gray-600 flex items-center bg-white px-4 py-3 rounded-lg">
                              å·²é¸æ“‡: <span className="font-bold text-blue-600 ml-1">{selectedBookings.length}</span> ç­†
                            </div>
                          </div>
                        )}

                        {/* è¨˜éŒ„åˆ—è¡¨ */}
                        <div className="space-y-4">
                          {filteredBookings.map(booking => (
                            <div 
                              key={booking.id} 
                              className={`border-2 rounded-lg p-6 transition-all ${
                                selectedBookings.includes(booking.id)
                                  ? 'border-blue-500 bg-blue-50'
                                  : 'border-gray-200 hover:shadow-md'
                              }`}
                            >
                              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-center">
                                {/* è¤‡é¸æ¡† + æœƒè­°å®¤ */}
                                <div className="flex items-center space-x-3">
                                  {recordView === 'current' && booking.status === 'å€Ÿç”¨ä¸­' && (
                                    <input
                                      type="checkbox"
                                      checked={selectedBookings.includes(booking.id)}
                                      onChange={() => handleCheckboxChange(booking.id)}
                                      className="w-5 h-5 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500"
                                    />
                                  )}
                                  <div>
                                    <div className="text-lg font-bold text-blue-600">
                                      ğŸ  {booking.roomName}
                                    </div>
                                  </div>
                                </div>

                                {/* å€Ÿç”¨äººè³‡è¨Š */}
                                <div>
                                  <div className="font-medium text-gray-800">
                                    ğŸ‘¤ {booking.borrower}
                                  </div>
                                  <div className="text-gray-600 text-sm">
                                    ğŸ“ åˆ†æ©Ÿ: {booking.extension}
                                  </div>
                                </div>

                                {/* æ™‚é–“è³‡è¨Š */}
                                <div>
                                  <div className="text-gray-600 text-sm">
                                    ğŸ“… {booking.date}
                                  </div>
                                  <div className="text-gray-600 text-sm">
                                    â° {booking.startTime}
                                  </div>
                                </div>

                                {/* ç‹€æ…‹ */}
                                <div>
                                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                    booking.status === 'å€Ÿç”¨ä¸­'
                                      ? 'bg-green-100 text-green-800'
                                      : 'bg-gray-100 text-gray-800'
                                  }`}>
                                    {booking.status === 'å€Ÿç”¨ä¸­' ? 'âœ…' : 'ğŸ”„'} {booking.status}
                                  </span>
                                  {booking.returnTime && (
                                    <div className="text-xs text-gray-500 mt-1">
                                      ğŸ”„ {booking.returnTime}
                                    </div>
                                  )}
                                </div>

                                {/* ID */}
                                <div className="text-sm text-gray-500">
                                  ID: {booking.id}
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<MeetingRoomSystem />, document.getElementById('root'));
    </script>
</body>
</html>
