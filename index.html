<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒè­°å®¤å€Ÿç”¨ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .header h1 {
            font-size: 24px;
            color: #1976d2;
            margin: 12px 0 8px 0;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        .admin-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #666;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .admin-btn:hover {
            background: #555;
        }
        
        .form-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .form-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .form-header h2 {
            color: #333;
            font-size: 18px;
        }
        
        .form-body {
            padding: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1976d2;
        }
        
        .btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 16px;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .reminder {
            background: #fff8e1;
            border: 1px solid #ffecb3;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
        }
        
        .reminder h3 {
            color: #f57f17;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .reminder ul {
            color: #f57f17;
            font-size: 14px;
            margin-left: 20px;
        }
        
        .reminder li {
            margin-bottom: 4px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .modal h3 {
            text-align: center;
            margin-bottom: 24px;
            font-size: 18px;
            color: #333;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn-secondary {
            background: #6c757d;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-primary {
            background: #1976d2;
            flex: 1;
        }
        
        .btn-primary:hover {
            background: #1565c0;
        }
        
        .admin-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .admin-title h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .admin-title p {
            color: #666;
            font-size: 14px;
        }
        
        .admin-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        
        .btn-indigo {
            background: #6366f1;
            color: white;
        }
        
        .btn-indigo:hover {
            background: #5856eb;
        }
        
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background: #4caf50;
            color: white;
        }
        
        .tab:not(.active) {
            background: #e9ecef;
            color: #666;
        }
        
        .tab:not(.active):hover {
            background: #dee2e6;
        }
        
        .records-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .record-item {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .record-item:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .record-item.selected {
            border-color: #1976d2;
            background: #e3f2fd;
        }
        
        .record-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        @media (min-width: 768px) {
            .record-grid {
                grid-template-columns: auto 1fr auto auto auto;
                align-items: center;
            }
        }
        
        .record-info {
            font-size: 14px;
        }
        
        .record-info strong {
            color: #333;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-returned {
            background: #f5f5f5;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .management-actions {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
            padding: 12px 24px;
            font-weight: bold;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .selected-count {
            background: white;
            padding: 12px 16px;
            border-radius: 6px;
            color: #666;
        }
        
        .hidden {
            display: none;
        }
        
        .checkbox {
            width: 18px;
            height: 18px;
            margin-right: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- ä½¿ç”¨è€…ä»‹é¢ -->
            <div id="user-interface">
                <!-- æ¨™é¡Œ -->
                <div class="header">
                    <div style="font-size: 32px;">ğŸ¢</div>
                    <h1>æœƒè­°å®¤å€Ÿç”¨ç³»çµ±</h1>
                    <p>è«‹å¡«å¯«å€Ÿç”¨è³‡è¨Š</p>
                    <button class="admin-btn" onclick="showLogin()">ğŸ”§ ç®¡ç†å“¡</button>
                </div>

                <!-- å€Ÿç”¨è¡¨å–® -->
                <div class="form-container">
                    <div class="form-header">
                        <h2>ğŸ“ å€Ÿç”¨ç”³è«‹</h2>
                        <p style="margin-top: 4px; color: #666; font-size: 14px;">è«‹å¡«å¯«å®Œæ•´è³‡è¨Š</p>
                    </div>
                    
                    <div class="form-body">
                        <div class="form-group">
                            <label>ğŸ  é¸æ“‡æœƒè­°å®¤ <span class="required">*</span></label>
                            <select id="roomId" class="form-control">
                                <option value="">è«‹é¸æ“‡æœƒè­°å®¤</option>
                                <option value="1">ç¬¬ä¸€æœƒè­°å®¤</option>
                                <option value="2">äºŒæœŸè¬›å ‚</option>
                                <option value="3">åˆå¿ƒæœƒè­°å®¤</option>
                                <option value="4">å’Œæ°£æœƒè­°å®¤</option>
                                <option value="5">äº’æ„›æœƒè­°å®¤</option>
                                <option value="6">è²´è³“å®¤</option>
                                <option value="7">å”åŠ›è¬›å ‚</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ğŸ¢ å€Ÿç”¨å–®ä½ <span class="required">*</span></label>
                            <input type="text" id="department" class="form-control" placeholder="è«‹è¼¸å…¥å–®ä½åç¨±">
                        </div>

                        <div class="form-group">
                            <label>ğŸ‘¤ å€Ÿç”¨äºº <span class="required">*</span></label>
                            <input type="text" id="borrower" class="form-control" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                        </div>

                        <div class="form-group">
                            <label>ğŸ“ åˆ†æ©Ÿè™Ÿç¢¼ <span class="required">*</span></label>
                            <input type="tel" id="extension" class="form-control" placeholder="è«‹è¼¸å…¥åˆ†æ©Ÿè™Ÿç¢¼">
                        </div>

                        <div class="form-group">
                            <label>ğŸ“… å€Ÿç”¨æ—¥æœŸ <span class="required">*</span></label>
                            <input type="date" id="date" class="form-control">
                        </div>

                        <div class="form-group">
                            <label>â° å€Ÿç”¨æ™‚é–“ <span class="required">*</span></label>
                            <input type="time" id="startTime" class="form-control">
                        </div>

                        <button class="btn" onclick="submitBooking()">âœ… ç¢ºèªå€Ÿç”¨</button>
                    </div>
                </div>

                <!-- ä½¿ç”¨æé†’ -->
                <div class="reminder">
                    <h3>ğŸ’¡ ä½¿ç”¨æé†’</h3>
                    <ul>
                        <li>å¡«å¯«å®Œæˆå¾Œè«‹åˆ°æ«ƒå°ç´¢å–é‘°åŒ™</li>
                        <li>è«‹æº–æ™‚ä½¿ç”¨æœƒè­°å®¤</li>
                        <li>ä½¿ç”¨å®Œç•¢è«‹æ­¸é‚„é‘°åŒ™</li>
                    </ul>
                </div>
            </div>

            <!-- ç®¡ç†å“¡ä»‹é¢ -->
            <div id="admin-interface" class="hidden">
                <div class="admin-container">
                    <div class="admin-header">
                        <div class="admin-title">
                            <h1>ğŸ› ï¸ æœƒè­°å®¤ç®¡ç†å¾Œå°</h1>
                            <p>ç®¡ç†å“¡å°ˆç”¨ - è¨˜éŒ„æŸ¥çœ‹èˆ‡æ­¸é‚„åŠŸèƒ½</p>
                        </div>
                        <div class="admin-buttons">
                            <button class="btn-small btn-indigo" onclick="showManualAdd()">â• æ‰‹å‹•æ–°å¢</button>
                            <button class="btn-small btn-secondary" onclick="switchToUser()">ğŸ‘¤ åˆ‡æ›åˆ°ä½¿ç”¨è€…ä»‹é¢</button>
                        </div>
                    </div>

                    <h2 style="margin-bottom: 24px; color: #333;">ğŸ“‹ å€Ÿç”¨è¨˜éŒ„ç®¡ç†</h2>
                    
                    <!-- è¨˜éŒ„é¡å‹åˆ‡æ› -->
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('current')" id="current-tab">
                            ğŸŸ¢ ç›®å‰å€Ÿç”¨ä¸­ (<span id="current-count">0</span>)
                        </button>
                        <button class="tab" onclick="switchTab('all')" id="all-tab">
                            ğŸ“‹ å…¨éƒ¨è¨˜éŒ„ (<span id="all-count">0</span>)
                        </button>
                    </div>

                    <!-- ç®¡ç†æ“ä½œ -->
                    <div id="management-actions" class="management-actions hidden">
                        <button class="btn btn-warning" onclick="returnSelected()">ğŸ”„ æ­¸é‚„é¸ä¸­çš„è¨˜éŒ„</button>
                        <div class="selected-count">
                            å·²é¸æ“‡: <span id="selected-count" style="font-weight: bold; color: #1976d2;">0</span> ç­†
                        </div>
                    </div>

                    <!-- è¨˜éŒ„åˆ—è¡¨ -->
                    <div id="records-container">
                        <div class="empty-state">
                            <div class="icon">ğŸ“­</div>
                            <p>ç›®å‰æ²’æœ‰ä»»ä½•è¨˜éŒ„</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™»å…¥å½ˆçª— -->
    <div id="login-modal" class="modal hidden">
        <div class="modal-content">
            <h3>ğŸ” ç®¡ç†å“¡ç™»å…¥</h3>
            <div class="form-group">
                <label>ğŸ‘¤ å¸³è™Ÿ</label>
                <input type="text" id="username" class="form-control" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¸³è™Ÿ">
            </div>
            <div class="form-group">
                <label>ğŸ”’ å¯†ç¢¼</label>
                <input type="password" id="password" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="hideLogin()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="login()">ç™»å…¥</button>
            </div>
        </div>
    </div>

    <!-- æ‰‹å‹•æ–°å¢å½ˆçª— -->
    <div id="manual-add-modal" class="modal hidden">
        <div class="modal-content">
            <h3>â• æ‰‹å‹•æ–°å¢è¨˜éŒ„</h3>
            <div class="form-group">
                <label>æœƒè­°å®¤ <span class="required">*</span></label>
                <select id="manual-roomId" class="form-control">
                    <option value="">è«‹é¸æ“‡æœƒè­°å®¤</option>
                    <option value="1">ç¬¬ä¸€æœƒè­°å®¤</option>
                    <option value="2">äºŒæœŸè¬›å ‚</option>
                    <option value="3">åˆå¿ƒæœƒè­°å®¤</option>
                    <option value="4">å’Œæ°£æœƒè­°å®¤</option>
                    <option value="5">äº’æ„›æœƒè­°å®¤</option>
                    <option value="6">è²´è³“å®¤</option>
                    <option value="7">å”åŠ›è¬›å ‚</option>
                </select>
            </div>
            <div class="form-group">
                <label>å€Ÿç”¨å–®ä½ <span class="required">*</span></label>
                <input type="text" id="manual-department" class="form-control" placeholder="è«‹è¼¸å…¥å–®ä½åç¨±">
            </div>
            <div class="form-group">
                <label>å€Ÿç”¨äºº <span class="required">*</span></label>
                <input type="text" id="manual-borrower" class="form-control" placeholder="è«‹è¼¸å…¥å€Ÿç”¨äººå§“å">
            </div>
            <div class="form-group">
                <label>åˆ†æ©Ÿè™Ÿç¢¼ <span class="required">*</span></label>
                <input type="tel" id="manual-extension" class="form-control" placeholder="è«‹è¼¸å…¥åˆ†æ©Ÿè™Ÿç¢¼">
            </div>
            <div class="form-group">
                <label>å€Ÿç”¨æ—¥æœŸ <span class="required">*</span></label>
                <input type="date" id="manual-date" class="form-control">
            </div>
            <div class="form-group">
                <label>å€Ÿç”¨æ™‚é–“ <span class="required">*</span></label>
                <input type="time" id="manual-startTime" class="form-control">
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="hideManualAdd()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitManualAdd()">æ–°å¢</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let bookings = [];
        let selectedBookings = [];
        let currentView = 'current';

        const rooms = {
            1: 'ç¬¬ä¸€æœƒè­°å®¤',
            2: 'äºŒæœŸè¬›å ‚',
            3: 'åˆå¿ƒæœƒè­°å®¤',
            4: 'å’Œæ°£æœƒè­°å®¤',
            5: 'äº’æ„›æœƒè­°å®¤',
            6: 'è²´è³“å®¤',
            7: 'å”åŠ›è¬›å ‚'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­å®šæœ€å°æ—¥æœŸç‚ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            
            // ç¶å®š Enter éµç™»å…¥
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });

        // é¡¯ç¤ºç™»å…¥å½ˆçª—
        function showLogin() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        // éš±è—ç™»å…¥å½ˆçª—
        function hideLogin() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // ç®¡ç†å“¡ç™»å…¥
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'hl1234' && password === 'admin1234') {
                hideLogin();
                switchToAdmin();
                alert('ç™»å…¥æˆåŠŸï¼');
            } else {
                alert('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // åˆ‡æ›åˆ°ç®¡ç†å“¡ä»‹é¢
        function switchToAdmin() {
            document.getElementById('user-interface').classList.add('hidden');
            document.getElementById('admin-interface').classList.remove('hidden');
            updateRecordsDisplay();
        }

        // åˆ‡æ›åˆ°ä½¿ç”¨è€…ä»‹é¢
        function switchToUser() {
            document.getElementById('admin-interface').classList.add('hidden');
            document.getElementById('user-interface').classList.remove('hidden');
            selectedBookings = [];
        }

        // æäº¤å€Ÿç”¨ç”³è«‹
        function submitBooking() {
            const roomId = document.getElementById('roomId').value;
            const department = document.getElementById('department').value;
            const borrower = document.getElementById('borrower').value;
            const extension = document.getElementById('extension').value;
            const date = document.getElementById('date').value;
            const startTime = document.getElementById('startTime').value;

            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!roomId || !department || !borrower || !extension || !date || !startTime) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
                return;
            }

            // æª¢æŸ¥æ™‚é–“è¡çª
            const hasConflict = bookings.some(booking => 
                booking.roomId === parseInt(roomId) &&
                booking.date === date &&
                booking.startTime === startTime &&
                booking.status === 'å€Ÿç”¨ä¸­'
            );

            if (hasConflict) {
                alert('è©²æœƒè­°å®¤åœ¨æ­¤æ™‚é–“å·²è¢«é ç´„ï¼è«‹é¸æ“‡å…¶ä»–æ™‚é–“ã€‚');
                return;
            }

            // æ–°å¢å€Ÿç”¨è¨˜éŒ„
            const newBooking = {
                id: Date.now(),
                roomId: parseInt(roomId),
                roomName: rooms[roomId],
                department: department,
                borrower: borrower,
                extension: extension,
                date: date,
                startTime: startTime,
                status: 'å€Ÿç”¨ä¸­',
                bookingTime: new Date().toLocaleString()
            };

            bookings.push(newBooking);

            // æ¸…ç©ºè¡¨å–®
            document.getElementById('roomId').value = '';
            document.getElementById('department').value = '';
            document.getElementById('borrower').value = '';
            document.getElementById('extension').value = '';
            document.getElementById('date').value = '';
            document.getElementById('startTime').value = '';

            alert(`å€Ÿç”¨æˆåŠŸï¼\n\næœƒè­°å®¤ï¼š${rooms[roomId]}\nå€Ÿç”¨å–®ä½ï¼š${department}\nå€Ÿç”¨äººï¼š${borrower}\n\nè«‹åˆ°æ«ƒå°ç´¢å–é‘°åŒ™ã€‚`);
        }

        // åˆ‡æ›è¨˜éŒ„é¡å‹æ¨™ç±¤
        function switchTab(view) {
            currentView = view;
            
            // æ›´æ–°æ¨™ç±¤æ¨£å¼
            document.getElementById('current-tab').classList.toggle('active', view === 'current');
            document.getElementById('all-tab').classList.toggle('active', view === 'all');
            
            // é‡ç½®é¸æ“‡
            selectedBookings = [];
            
            updateRecordsDisplay();
        }

        // æ›´æ–°è¨˜éŒ„é¡¯ç¤º
        function updateRecordsDisplay() {
            const currentBookings = bookings.filter(b => b.status === 'å€Ÿç”¨ä¸­');
            
            // æ›´æ–°è¨ˆæ•¸
            document.getElementById('current-count').textContent = currentBookings.length;
            document.getElementById('all-count').textContent = bookings.length;
            
            let filteredBookings = currentView === 'current' ? currentBookings : bookings;
            
            const container = document.getElementById('records-container');
            const managementActions = document.getElementById('management-actions');
            
            // é¡¯ç¤º/éš±è—ç®¡ç†æ“ä½œ
            if (currentView === 'current' && filteredBookings.length > 0) {
                managementActions.classList.remove('hidden');
            } else {
                managementActions.classList.add('hidden');
            }
            
            // æ›´æ–°é¸æ“‡è¨ˆæ•¸
            document.getElementById('selected-count').textContent = selectedBookings.length;
            
            if (filteredBookings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>${currentView === 'current' ? 'ç›®å‰æ²’æœ‰å€Ÿç”¨ä¸­çš„è¨˜éŒ„' : 'ç›®å‰æ²’æœ‰ä»»ä½•è¨˜éŒ„'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="records-list">
                    ${filteredBookings.map(booking => `
                        <div class="record-item ${selectedBookings.includes(booking.id) ? 'selected' : ''}">
                            <div class="record-grid">
                                <div style="display: flex; align-items: center;">
                                    ${currentView === 'current' && booking.status === 'å€Ÿç”¨ä¸­' ? 
                                        `<input type="checkbox" class="checkbox" ${selectedBookings.includes(booking.id) ? 'checked' : ''} onchange="toggleSelection(${booking.id})">` : ''}
                                    <strong>ğŸ  ${booking.roomName}</strong>
                                </div>
                                <div class="record-info">
                                    <div><strong>ğŸ¢ ${booking.department}</strong></div>
                                    <div><strong>ğŸ‘¤ ${booking.borrower}</strong></div>
                                    <div style="color: #666; font-size: 12px;">ğŸ“ åˆ†æ©Ÿ: ${booking.extension}</div>
                                </div>
                                <div class="record-info">
                                    <div>ğŸ“… ${booking.date}</div>
                                    <div>â° ${booking.startTime}</div>
                                </div>
                                <div>
                                    <span class="status-badge ${booking.status === 'å€Ÿç”¨ä¸­' ? 'status-active' : 'status-returned'}">
                                        ${booking.status === 'å€Ÿç”¨ä¸­' ? 'âœ…' : 'ğŸ”„'} ${booking.status}
                                    </span>
                                    ${booking.returnTime ? `<div style="font-size: 11px; color: #666; margin-top: 4px;">ğŸ”„ ${booking.returnTime}</div>` : ''}
                                </div>
                                <div style="color: #999; font-size: 12px;">
                                    ID: ${booking.id}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // åˆ‡æ›é¸æ“‡ç‹€æ…‹
        function toggleSelection(bookingId) {
            if (selectedBookings.includes(bookingId)) {
                selectedBookings = selectedBookings.filter(id => id !== bookingId);
            } else {
                selectedBookings.push(bookingId);
            }
            updateRecordsDisplay();
        }

        // æ­¸é‚„é¸ä¸­çš„è¨˜éŒ„
        function returnSelected() {
            if (selectedBookings.length === 0) {
                alert('è«‹å…ˆé¸æ“‡è¦æ­¸é‚„çš„è¨˜éŒ„ï¼');
                return;
            }
            
            const currentTime = new Date().toLocaleString();
            bookings = bookings.map(booking => {
                if (selectedBookings.includes(booking.id) && booking.status === 'å€Ÿç”¨ä¸­') {
                    return {
                        ...booking,
                        status: 'å·²æ­¸é‚„',
                        returnTime: currentTime
                    };
                }
                return booking;
            });
            
            const count = selectedBookings.length;
            selectedBookings = [];
            updateRecordsDisplay();
            alert(`å·²æ­¸é‚„ ${count} ç­†è¨˜éŒ„ï¼`);
        }

        // é¡¯ç¤ºæ‰‹å‹•æ–°å¢å½ˆçª—
        function showManualAdd() {
            document.getElementById('manual-add-modal').classList.remove('hidden');
        }

        // éš±è—æ‰‹å‹•æ–°å¢å½ˆçª—
        function hideManualAdd() {
            document.getElementById('manual-add-modal').classList.add('hidden');
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('manual-roomId').value = '';
            document.getElementById('manual-department').value = '';
            document.getElementById('manual-borrower').value = '';
            document.getElementById('manual-extension').value = '';
            document.getElementById('manual-date').value = '';
            document.getElementById('manual-startTime').value = '';
        }

        // æäº¤æ‰‹å‹•æ–°å¢
        function submitManualAdd() {
            const roomId = document.getElementById('manual-roomId').value;
            const department = document.getElementById('manual-department').value;
            const borrower = document.getElementById('manual-borrower').value;
            const extension = document.getElementById('manual-extension').value;
            const date = document.getElementById('manual-date').value;
            const startTime = document.getElementById('manual-startTime').value;

            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!roomId || !department || !borrower || !extension || !date || !startTime) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
                return;
            }

            // æª¢æŸ¥æ™‚é–“è¡çª
            const hasConflict = bookings.some(booking => 
                booking.roomId === parseInt(roomId) &&
                booking.date === date &&
                booking.startTime === startTime &&
                booking.status === 'å€Ÿç”¨ä¸­'
            );

            if (hasConflict) {
                alert('è©²æœƒè­°å®¤åœ¨æ­¤æ™‚é–“å·²è¢«é ç´„ï¼è«‹é¸æ“‡å…¶ä»–æ™‚é–“ã€‚');
                return;
            }

            // æ–°å¢å€Ÿç”¨è¨˜éŒ„
            const newBooking = {
                id: Date.now(),
                roomId: parseInt(roomId),
                roomName: rooms[roomId],
                department: department,
                borrower: borrower,
                extension: extension,
                date: date,
                startTime: startTime,
                status: 'å€Ÿç”¨ä¸­',
                bookingTime: new Date().toLocaleString()
            };

            bookings.push(newBooking);
            hideManualAdd();
            updateRecordsDisplay();
            alert('æ‰‹å‹•è¨˜éŒ„æ–°å¢æˆåŠŸï¼');
        }
    </script>
</body>
</html>
